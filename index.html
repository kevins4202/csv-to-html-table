<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="styles.css" />
  <style>
    th,
    td {
      border: 1px solid;
    }

    table {
      border-collapse: collapse;
    }
  </style>
</head>

<body>
  <h1 style="margin-left: 15px;">CSImpact</h1>
  <p style="margin-left: 15px;">Objective ranking of computer science programs from institutions around the world, based
    on Google Scholar
    research data of professors.</p>
  <select style="margin-left: 20px;" id="metric">
    <option value="overall">Overall</option>
    <option value="total_citations">Total Citations</option>
    <option value="avg_citations">Average Citations</option>
    <option value="total_h_index">Total h-index</option>
    <option value="avg_h_index">Average h-index</option>
  </select>

  <button type="submit" onclick='replaceCSV();'>Submit</button>

  <div id = "csv1" style = "max-width: 1350px;">
    
  </div>

  <script>
    const data = document.createElement("table");
    data.id = "csv1";
    data.style.margin = "25px auto 25px 20px";
    data.style.maxWidth = "1350px";
    data.classList.add("table" ,"table-striped", "table-hover");
    data.innerHTML  = "<thead></thead><tbody></tbody>";
    
    appendTo = document.getElementById("csv1");
    appendTo.appendChild(data);

    function replaceCSV() {
      // var list = document.getElementsByTagName("td");
      // for(var x = 0; x < list.length; x++){
      //   list[x].remove();
      // }
      list = document.getElementsByTagName("tr");
      for (var x = list.length - 1; x >= 0; x--) {
        list[x].remove();
      }

      fetch("./" + document.getElementById("metric").value + "_ranking.csv")
        .then(response => {
          if (!response.ok) {
            throw new Error("Http error");
          }
          return response.text();
        })
        .then(table => {
          csv2html(document.getElementById("metric").value, table, document.getElementById("csv1"), true);
        });
    }
  </script>

  

  

  <script>
    

    fetch("./overall_ranking.csv")
      .then(response => {
        if (!response.ok) {
          throw new Error("Http error");
        }
        return response.text();
      })
      .then(table => {
        csv2html("./overall_ranking.csv", table, document.getElementById("csv1"), true);
      });

    /**
     * Takes a CSV and places it inside an HTML table.
     * @param data The CSV data (with line breaks and comma-spearated values)
     * @param tableElement The string of the id of the table the CSV is being placed into (must have blank thead and tbody elements)
     * @param hasHeader Should he CSV data have a header?
     */
    function csv2html(fileName, data, tableElement, hasHeader) {
      const rows = data.split("\n");

      let currUni = "";
      let i = 0;

      if (hasHeader) {
        const header = document.createElement("tr");
        rows[0].split(',').forEach(cellData => {
          // if (i == 1) currUni = cellData;
          const th = document.createElement("th");
          th.textContent = cellData;
          header.appendChild(th);
          i += 1;
        });
        tableElement.querySelector("thead").appendChild(header);
      }

      

      let nestedHeaders = ["Name", "Homepage", "Citations", "h-index"];
      let indexes = [0,2,4,5];

      for (let i = hasHeader ? 1 : 0; i < 100; i++) {
        const tr = document.createElement("tr");
        tr.dataset.toggle = "collapse";
        tr.dataset.target = '#' + currUni;
        tr.classList.add("accordion-toggle");

        

        // const hidden = document.createElement("table");
        // hidden.append()

        let tmp_rows = rows[i].split(",");
        for(let z = 0; z < tmp_rows.length; z++){
          if(z==1) currUni = tmp_rows[z];
          const td = document.createElement("td");
          td.textContent = tmp_rows[z];
          tr.appendChild(td);

          // tr.style.data
        }

        currUni = currUni.split(' ').join("_");

        tr.dataset.target = '#' + currUni;
        tr.classList.add("accordion-toggle");
        tableElement.querySelector('tbody').appendChild(tr);

        
        //NESTED STUFF
        
        const nestedTable = document.createElement("table");
        nestedTable.innerHTML = "<thead></thead>\n<tbody></tbody>"
        nestedTable.id  = currUni + "_table";
        
        //this is the collapsing row
        const tr2 = document.createElement("tr");
        tr2.id= currUni;
        tr2.innerHTML = `<td colspan = "6" style = "max-width: 1350px"></td>`
        //HEADER

        const thtr3 = document.createElement("tr");

        for(let j = 0; j < nestedHeaders.length; j++){
          
          const th = document.createElement("th");
          
          th.textContent = nestedHeaders[j];
          thtr3.appendChild(th);
        }

        //get the graphs

        const imgTable = document.createElement("table");
        const th1 = document.createElement("tr");
        const th2 = document.createElement("tr");

        th1.innerHTML = `<iframe src = ./college_graphs/${currUni}/${currUni}_h_index.html></iframe>`;

        th2.innerHTML = `<iframe src = ./college_graphs/${currUni}/${currUni}_citations.html></iframe>`;


        // if(fileName.includes("index")){
        //   imgTable.appendChild(th1);
        // } else if(fileName.includes("citation")){
        //   imgTable.appendChild(th2);
        // } else{
        //   imgTable.appendChild(th1);
        //   imgTable.appendChild(th2);
        // }

        // tr2.appendChild(imgTable);

        nestedTable.querySelector('thead').appendChild(thtr3);

        // get all professor data
        // alert(currUni);
        fetch(`./college_data/${currUni}.csv`)
          .then(response => {
            if (!response.ok) {
              // throw new Error("Http error");
            }
            return response.text();
          })
          .then(table => {
            const trows = table.split("\n");
            for(let j = 1; j < trows.length; j++){
              const trow = document.createElement("tr");


              // if()

              // const hidden = document.createElement("table");
              // hidden.append()

              let temp_list = trows[j].split(",");
              
              for(let k = 0; k < indexes.length; k++){
                const td = document.createElement("td");
                td.textContent = temp_list[indexes[k]];
                td.style.maxWidth = "1350px";
                trow.appendChild(td);
              }

              nestedTable.querySelector('tbody').appendChild(trow);
            }
          });

          // nestedTable.classList.add()
          
          const tableDiv = document.createElement("div");
          tableDiv.classList.add('accordion-body');
          tableDiv.classList.add('collapse');
          tableDiv.appendChild(nestedTable);
          tr2.querySelector('td').appendChild(tableDiv);
          tr2.classList.add('nestedT');
          tableElement.querySelector('tbody').appendChild(tr2);
          nestedTable.style.maxWidth = "1350px";
          tr2.style.maxWidth = "1350px";
          
      }

      document.getElementById("csv1").style.maxWidth = "1350px";
      $('.accordion-body').on('show.bs.collapse', function () {
        $(this).closest("table")
            .find(".collapse.in")
            .not(this)
            .collapse('toggle')
    })
      
      // class="collapsed" data-toggle="collapse" data-target="#grandparentContent" data-role="expander" data-group-id="grandparent">
    }
  </script>
</body>
<footer class="row">
  <div class="col" style="right: 0">
    <hr>
    <p class="text-right" style = "margin-left: 20px;">Kevin Song</p>
    <p class="text-right" style = "margin-left: 20px;">under the guidance of Professor Remzi Arpaci-Dusseau</p>
  </div>
</footer>

</html>